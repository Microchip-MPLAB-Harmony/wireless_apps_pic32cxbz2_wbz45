<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE11" /><meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="DC.type" content="topic" />
<meta name="DC.title" content="Zigbee Over The Air Update Demo" />
<meta name="Description" content="Zigbee Over the Air Update(OTAU) is discussed in this section" />
<meta name="DC.relation" scheme="URI" content="GUID-A3F96AEA-7517-4859-9799-149B152B5BC4.html" />
<meta name="DC.relation" scheme="URI" content="GUID-A40B634A-339D-4B50-9146-1FA15512D537.html" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="GUID-1F6A4D91-48E2-4ACF-B566-CFD184B6FF5C" />
<meta name="DC.language" content="en-US" />
<link rel="stylesheet" type="text/css" href="stylesheets/atmel.css" />
<title>Zigbee Over The Air Update Demo</title>
<meta name="Microsoft.Help.Id" content="GUID-A5330D3A-9F51-4A26-B71D-8503A493DF9C-GUID-1F6A4D91-48E2-4ACF-B566-CFD184B6FF5C" />
<meta name="Microsoft.Help.TocParent" content="GUID-A5330D3A-9F51-4A26-B71D-8503A493DF9C-GUID-A3F96AEA-7517-4859-9799-149B152B5BC4" />
<meta name="Microsoft.Help.TocOrder" content="2" />
<meta name="Microsoft.Help.Locale" content="en-US" />
<meta name="Microsoft.Help.TopicLocale" content="en-US" />
<meta name="Microsoft.Help.DisplayVersion" content="Software Development Reference A 09/2022" />
<script language="javascript">
       
       if (window.parent.location.protocol != 'file:') {
				document.addEventListener('click', function(e) {
				    if (e.target) {
               if (e.target.nodeName == "A" ) {
                    if (!e.target.target) {
                      e.preventDefault();
                      e.stopPropagation();
                              
                      var origUrl = window.parent.location.href.substr(0, window.parent.location.href.indexOf("?"));
                      if (origUrl.length === 0) {
                          origUrl = window.parent.location.href;
                      }
                      var href= e.target.getAttribute("href");
                      var parts = href.split("#");
          
                      var url = "";
                      if (parts.length == 2 ) {
                        if (!parts[0].length) {
                            url = window.parent.location.search.replace('?','')
                        } else {
                            url = parts[0].replace('.html','');
                        }
                      } else {
                        url = parts[0].replace('.html','');
                      }

                      if (parts.length == 2) {
                          url += "#" + parts[1];
                      }
    
                      window.parent.location.href = origUrl + "?" + url;

                      return false;
                    }
               }
            }
				});
			}

		</script><script language="javascript">
         
         function copyContent(content, button) {
         
            var textArea = document.createElement("textarea");
            
            // Place in the top-left corner of screen regardless of scroll position.
            textArea.style.position = 'fixed';
            textArea.style.top = 0;
            textArea.style.left = 0;
            
            // Ensure it has a small width and height. Setting to 1px / 1em
            // doesn't work as this gives a negative w/h on some browsers.
            textArea.style.width = '2em';
            textArea.style.height = '2em';
            
            // We don't need padding, reducing the size if it does flash render.
            textArea.style.padding = 0;
            
            // Clean up any borders.
            textArea.style.border = 'none';
            textArea.style.outline = 'none';
            textArea.style.boxShadow = 'none';
            
            // Avoid flash of the white box if rendered for any reason.
            textArea.style.background = 'transparent';
            
            textArea.value = content;
            
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
               var successful = document.execCommand('copy');
               var msg = successful ? 'successful' : 'unsuccessful';
               if (!button.classList.contains("copied")){
                  button.textContent = "Copied";
                  button.classList.add("copied");
                  setTimeout(function(){
                     button.textContent = "Copy";
                     button.classList.remove("copied");
                  },1000);
               }
            } catch (err) {
               console.log('Oops, unable to copy');
            }
            
            document.body.removeChild(textArea);
         }
         
         function cpy(id, button) {
            var element = document.getElementById(id);
            var content = element.getAttribute("content");
            
            copyContent(content, button);
         }
         
         document.addEventListener("DOMContentLoaded", function(event) {
            document.querySelectorAll(".codeblock").forEach(function(elem) {
               elem.style.position = "relative";
               var copy = document.createElement("button");
               copy.textContent = "Copy";
               copy.setAttribute("class", "copy-code");
               
               var content = elem.textContent;
               
               copy.addEventListener("click", function(){
                  copyContent(content, copy);
               });
               
               elem.addEventListener("mouseenter", function(evt){
                  elem.prepend(copy);
               });
            });
            
            document.querySelectorAll(".codeblock").forEach(function(elem) {
               elem.addEventListener("mouseleave", function(evt){
                  document.querySelector(".copy-code").remove();
               });
            });
         });
         
      </script><script language="javascript">
          
          // Add the MathML namespace to html
          var html = document.getElementsByTagName("html")[0],
          head = document.getElementsByTagName("head")[0];
          
          var mathJax = document.createElement("script");
          mathJax.src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML";
          head.appendChild(mathJax);
          
          html.setAttribute("xmlns:m","http://www.w3.org/1998/Math/MathML");
          
          function inIframe() { try { return window.self !== window.top; } catch (e) { return true; } }
          
          if (!inIframe()) { 
          
          var Default = "index.html?GUID-1F6A4D91-48E2-4ACF-B566-CFD184B6FF5C"; 
          
          var displaylocation = "value" + window.location.href;
          
          var GUIDS = displaylocation.split('GUID');          
          
          if (displaylocation.indexOf('#GUID') != -1) {            
          var First = GUIDS[1].split('.html');  
          if (GUIDS[3]){First = GUIDS[2].split('.html');}
          if (GUIDS[4]){First = GUIDS[3].split('.html');}
          if (GUIDS[5]){First = GUIDS[4].split('.html');}
          
          var Second = GUIDS[2].split('#');   
          if (GUIDS[3]){Second = GUIDS[3].split('#');}
          if (GUIDS[4]){Second = GUIDS[4].split('#');}
          if (GUIDS[5]){Second = GUIDS[5].split('#');}
          
          Default = "index.html?" + "GUID" + First[0] + "GUID" + Second[0];     
          }                    
          window.top.location = Default;
          }       
          
        </script><link rel="stylesheet" type="text/css" href="syntax-highlight.css" /><style xml:space="">
        
          button.copy-code{
            display:none;
            padding:0.7em 1.4em;
            margin:0 0.3em 0.3em 0;
            border-radius:0.15em;
            box-sizing: border-box;
            text-decoration:none;
            font-family:'Roboto',sans-serif;
            text-transform:uppercase;
            font-weight:400;
            color:#FFFFFF;
            background-color:#9c9c9c;
            box-shadow:inset 0 -0.6em 0 -0.35em rgba(0,0,0,0.17);
            text-align:center;
            position:relative;
            border: 0;
            float: right;
            border-radius: .5em;
            cursor: pointer;
          }
          button.copy-code:active{
            top:0.1em;
          }
          
          pre:hover button.copy-code{
            display: inline-block !important;
          }
          button.copy-code.copied {
            cursor: default !important;
          }
          
          
          @media all and (max-width:30em){
            button.copy-code{
              display:block;
              margin:0.4em auto;
            }
          }
        
        
      </style><link rel="stylesheet" type="text/css" href="syntax-highlight.css" /></head>
<body id="GUID-1F6A4D91-48E2-4ACF-B566-CFD184B6FF5C">
<h1 class="title topictitle1" id="GUID-1F6A4D91-48E2-4ACF-B566-CFD184B6FF5C__GUID-E381FB8F-61B3-439B-A2A3-4CB9DEAAFEE7" style="">Zigbee Over The Air Update Demo</h1><div class="body"><p class="shortdesc">Zigbee Over the Air Update(OTAU) is discussed in this section</p>
<p class="p"><strong class="ph b">Hardware Requirements</strong></p>
<ul class="ul"><li class="li" id="GUID-1F6A4D91-48E2-4ACF-B566-CFD184B6FF5C__GUID-0E7FEC4D-C873-40C6-B541-A7127FF7728C"><p class="p">Two or more WBZ451 Curiosity Board</p>
</li>
<li class="li" id="GUID-1F6A4D91-48E2-4ACF-B566-CFD184B6FF5C__GUID-E68DBF94-135A-4DED-A0E6-6F1FB5D3A780"><p class="p">USB Cables</p>
</li>
<li class="li" id="GUID-1F6A4D91-48E2-4ACF-B566-CFD184B6FF5C__GUID-A6A40B39-D779-4996-A953-95B83F2F5A2A"><p class="p">PC</p>
</li>
</ul>
<p class="p"><strong class="ph b">Software Requirements</strong></p>
<ul class="ul"><li class="li" id="GUID-1F6A4D91-48E2-4ACF-B566-CFD184B6FF5C__GUID-44F11AE1-4AB9-4305-B8E1-5856007B39A6"><p class="p">MPLABX IDE/IPE</p>
</li>
<li class="li" id="GUID-1F6A4D91-48E2-4ACF-B566-CFD184B6FF5C__GUID-B845335E-EC09-4977-935B-757DE2EE44DC"><p class="p">MicrochipUtilityTool.exe</p>
</li>
<li class="li" id="GUID-1F6A4D91-48E2-4ACF-B566-CFD184B6FF5C__GUID-DC745D2F-BABF-4E49-91D9-1F907BED9D78"><p class="p">Zigbee OTAU Server and Client Image(*.hex)</p>
</li>
<li class="li" id="GUID-1F6A4D91-48E2-4ACF-B566-CFD184B6FF5C__GUID-DDC76119-3D1D-499F-8479-9946A216CD01"><p class="p">Zigbee OTA Image(*.zigbee)</p>
</li>
<li class="li" id="GUID-1F6A4D91-48E2-4ACF-B566-CFD184B6FF5C__GUID-EE5E1892-D1DD-43A0-877F-ED139E63A0DE"><p class="p">Terminal Emulator like TeraTerm</p>
</li>
</ul>
<p class="p"><strong class="ph b">Procedure</strong></p>
<ul class="ul"><li class="li" id="GUID-1F6A4D91-48E2-4ACF-B566-CFD184B6FF5C__GUID-373542CA-086D-4C6D-AB50-5FDBA21FA87B"><p class="p">Program, Zigbee OTA Server Image into One WBZ451 Curiosity board</p>
</li>
<li class="li" id="GUID-1F6A4D91-48E2-4ACF-B566-CFD184B6FF5C__GUID-AC9DB285-2AA2-485B-999A-26B4020AE921"><p class="p">Program, Zigbee Client Image into One or more WBZ451 Curiosity Boards</p>
</li>
<li class="li" id="GUID-1F6A4D91-48E2-4ACF-B566-CFD184B6FF5C__GUID-FBEF9339-E46C-4830-BC27-F377C7166E8D"><p class="p">Connect Server and Client/Clients board with USB to PC and start TeraTerm for each board</p>
</li>
<li class="li" id="GUID-1F6A4D91-48E2-4ACF-B566-CFD184B6FF5C__GUID-8B5E4B68-F067-472C-972C-6A7DDC8B9624"><p class="p">Type resetToFN on every board’s Tera Term</p>
</li>
<li class="li" id="GUID-1F6A4D91-48E2-4ACF-B566-CFD184B6FF5C__GUID-D3953CAA-2FD2-41FA-BAC1-BA27C46D7A01"><p class="p">Wait for network to establish. The following type of messages will appear on Tera Term</p>
</li>
</ul>
<ul class="ul"><li class="li" id="GUID-1F6A4D91-48E2-4ACF-B566-CFD184B6FF5C__GUID-081721CE-E5C8-4791-BFF6-2C6D08DE73A1"><p class="p">Device joined: Address 0xABCD MACID 0x000000000000EFBA ExtendedPANID 0x0000000000003578</p>
</li>
<li class="li" id="GUID-1F6A4D91-48E2-4ACF-B566-CFD184B6FF5C__GUID-6EC361D8-C0D4-4F7E-81A4-A7924A5A755A"><p class="p">Device joined: Address 0x1234 MACID 0x000000000000QRST ExtendedPANID 0x000000000000789A</p>
</li>
<li class="li" id="GUID-1F6A4D91-48E2-4ACF-B566-CFD184B6FF5C__GUID-26828389-11A3-4840-987F-5EBFFE5CFA5C"><p class="p">Note: Numbers above are for illustration purposes only. These numbers will be different.</p>
</li>
</ul>
<ul class="ul"><li class="li" id="GUID-1F6A4D91-48E2-4ACF-B566-CFD184B6FF5C__GUID-52707223-A835-4EF8-8D81-0F245AE8528C"><p class="p">Close Server Terra Term</p>
</li>
<li class="li" id="GUID-1F6A4D91-48E2-4ACF-B566-CFD184B6FF5C__GUID-08190F33-47C8-4C17-812A-92C860944960"><p class="p">Start MicrochipUtilityTool.exe</p>
<ul class="ul"><li class="li" id="GUID-1F6A4D91-48E2-4ACF-B566-CFD184B6FF5C__GUID-1D4D5A31-2BB4-4D25-BA87-37139E119FD3"><p class="p">Follow steps mentioned in the following picture. The demo shows two devices</p>
</li>
</ul>
</li>
</ul>
<ol class="ol" id="GUID-1F6A4D91-48E2-4ACF-B566-CFD184B6FF5C__GUID-533C078D-46E2-40C9-A5BD-3D3EC6AFF7D6"><li class="li" id="GUID-1F6A4D91-48E2-4ACF-B566-CFD184B6FF5C__GUID-2673FA3F-4413-4BE0-AFCB-6626816ADEAD"><span class="indent-level-default">1.</span><p class="p">Click on Zigbee OTAU Tab</p>
</li>
<li class="li" id="GUID-1F6A4D91-48E2-4ACF-B566-CFD184B6FF5C__GUID-CD0EC7FF-01AB-4436-BA55-8ACB559E50E9"><span class="indent-level-default">2.</span><p class="p">Select Baud Rate as 115200 from the drop-down menu</p>
</li>
<li class="li" id="GUID-1F6A4D91-48E2-4ACF-B566-CFD184B6FF5C__GUID-14185280-5C81-4BEB-B071-A83889A5EA20"><span class="indent-level-default">3.</span><p class="p">Select Zigbee OTA Server Serial Port from the drop-down menu</p>
</li>
<li class="li" id="GUID-1F6A4D91-48E2-4ACF-B566-CFD184B6FF5C__GUID-EDCBB2C8-5347-46C7-A983-85155B1D726E"><span class="indent-level-default">4.</span><p class="p">Click on Connect/Disconnect Button</p>
<ul class="ul"><li class="li" id="GUID-1F6A4D91-48E2-4ACF-B566-CFD184B6FF5C__GUID-051C83E4-8B40-4CF2-AB5C-793CE3A33316"><div class="p">Click Ok on popup windows<div class="fig fignone" id="GUID-1F6A4D91-48E2-4ACF-B566-CFD184B6FF5C__GUID-6869EA87-5475-4BAE-9A66-792B6B40BE32"><div class="figcap"><span class="fig--title-label">Figure 1. </span>Figure 4: Zigbee Server Connection. </div><span class="desc figdesc"></span><img class="image" src="GUID-76114D40-996E-4F64-AFB2-556099B2FB9D-low.jpg" /></div>
</div>
</li>
</ul>
</li>
<li class="li" id="GUID-1F6A4D91-48E2-4ACF-B566-CFD184B6FF5C__GUID-82C7E30F-E858-4518-85AC-CEC9311FC2E6"><span class="indent-level-default">5.</span><p class="p">Wait for connected device to appear on the device list</p>
</li>
<li class="li" id="GUID-1F6A4D91-48E2-4ACF-B566-CFD184B6FF5C__GUID-C8710E4F-68A3-4A6F-8068-B7FF660AF8AD"><span class="indent-level-default">6.</span><p class="p">Click on Select File button from each device list and select *.zigbee file for each device(up to 5)</p>
</li>
<li class="li" id="GUID-1F6A4D91-48E2-4ACF-B566-CFD184B6FF5C__GUID-E9DB4D58-CBEF-4852-9CCC-86387E19EF49"><span class="indent-level-default">7.</span><p class="p">Click on Zigbee Update button</p>
<div class="p"><div class="fig fignone" id="GUID-1F6A4D91-48E2-4ACF-B566-CFD184B6FF5C__GUID-BFE21D5E-80E5-4BC2-82E2-67367E428B7F"><div class="figcap"><span class="fig--title-label">Figure 2. </span>Figure 5: Zigbee OTAU Process Start. </div><span class="desc figdesc"></span><img class="image" src="GUID-7275F818-0875-4E66-92F9-186807FC848B-low.jpg" /></div>
</div>
</li>
</ol>
<p class="p">Image keeps transferring frame by frame to each client node. Progress bar keep advancing. % Progress keeps advancing for selected device in the device list till all reach 100% for every selected client node. OTA Status shows OTAU Done. Tera Term connected with client shows Image Transferred Successfully and reboots after 5 sec into new Image as last command sent from Tool is reboot client devices after 5 sec.</p>
<div class="p"><div class="fig fignone" id="GUID-1F6A4D91-48E2-4ACF-B566-CFD184B6FF5C__GUID-BD0E6F6E-D919-4C8E-9BB4-CCE65B69937B"><div class="figcap"><span class="fig--title-label">Figure 3. </span>Figure 6: Zigbee OTAU Process Finish. </div><span class="desc figdesc"></span><img class="image" src="GUID-B4EB6948-3EC2-4DCF-9634-2041B8C64389-low.jpg" /></div>
</div>
<p class="p"><strong class="ph b">Summary</strong></p>
<ul class="ul"><li class="li" id="GUID-1F6A4D91-48E2-4ACF-B566-CFD184B6FF5C__GUID-69C2DE32-49A0-42F3-87A7-4AC614EA77E4"><p class="p">Maximum 5 client can be updated at a time. This limitation comes from Zigbee Server.</p>
</li>
<li class="li" id="GUID-1F6A4D91-48E2-4ACF-B566-CFD184B6FF5C__GUID-F3674FD6-09EC-4A08-BF2C-D4AE01F5E89F"><p class="p">Maximum 48 bytes payload can be sent in a frame at a time</p>
</li>
<li class="li" id="GUID-1F6A4D91-48E2-4ACF-B566-CFD184B6FF5C__GUID-B0F057B0-56B2-41E1-BFD2-0D8AE8EFC60F"><p class="p">Out of Full packet size of 89 bytes, 39 bytes are header.</p>
</li>
<li class="li" id="GUID-1F6A4D91-48E2-4ACF-B566-CFD184B6FF5C__GUID-B834D784-319D-40FB-A676-FF2695D4966F"><p class="p">It takes long time to transmit all the image data to client</p>
<ul class="ul"><li class="li" id="GUID-1F6A4D91-48E2-4ACF-B566-CFD184B6FF5C__GUID-30EE605F-D390-46D5-BCC3-6705258CA171"><p class="p">setMinimunBlockPeriod xx can be used set interpacket timing. It is recommended xx should be &gt; 100 ms</p>
</li>
</ul>
</li>
<li class="li" id="GUID-1F6A4D91-48E2-4ACF-B566-CFD184B6FF5C__GUID-B33E0CD8-A3B1-4FFF-AE43-CE0480212F80"><p class="p">The Image used for this demo has 200 ms interpacket timing. Default is set to 1000 ms interpacket timing. It takes 32 min 17 sec to transmit entire image, Image Size = 307784 bytes.</p>
</li>
<li class="li" id="GUID-1F6A4D91-48E2-4ACF-B566-CFD184B6FF5C__GUID-5AFF9977-1E36-409A-BA79-D80686017BEA"><p class="p">Once the OTAU is started, File transfer can be initiated into new nodes appeared in the device list.</p>
</li>
<li class="li" id="GUID-1F6A4D91-48E2-4ACF-B566-CFD184B6FF5C__GUID-63CD6FFA-006F-44B3-865F-178965599BEB"><p class="p">Time out (status = 0x95) in client node is not transmitted to OTA Server.</p>
<ul class="ul"><li class="li" id="GUID-1F6A4D91-48E2-4ACF-B566-CFD184B6FF5C__GUID-EF2710D2-4972-44FE-9CC9-B9EA806CF315"><p class="p">A 30 sec timeout has been introduced in the Tool to exit OTA process for not getting any update from the OTA server during OTA process.</p>
</li>
</ul>
</li>
</ul>
<p class="p"></p>
</div>
<div class="related-links">
<ul class="ullinks">
<li class="link ulchildlink"><strong><a href="GUID-A40B634A-339D-4B50-9146-1FA15512D537.html">ISD Protocol</a></strong><br />
Zigbee server communicates with the PC Tools using ISD protocol</li>
</ul>

<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="GUID-A3F96AEA-7517-4859-9799-149B152B5BC4.html" title="Microchip Utility Tool is windows based GUI Tool used for firmware upgrade.">Microchip Utility Tool</a></div>
</div>
</div></body>
</html>