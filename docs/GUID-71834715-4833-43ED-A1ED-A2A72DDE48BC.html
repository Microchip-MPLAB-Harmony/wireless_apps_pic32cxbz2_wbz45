<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE11" /><meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="DC.type" content="topic" />
<meta name="DC.title" content="BLE Virtual Sniffer" />
<meta name="DC.relation" scheme="URI" content="GUID-3CC3561E-252E-43B9-BC8A-47DD108A0A46.html" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC" />
<meta name="DC.language" content="en-US" />
<link rel="stylesheet" type="text/css" href="stylesheets/atmel.css" />
<title>BLE Virtual Sniffer</title>
<meta name="Microsoft.Help.Id" content="GUID-A5330D3A-9F51-4A26-B71D-8503A493DF9C-GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC" />
<meta name="Microsoft.Help.TocParent" content="GUID-A5330D3A-9F51-4A26-B71D-8503A493DF9C-GUID-3CC3561E-252E-43B9-BC8A-47DD108A0A46" />
<meta name="Microsoft.Help.TocOrder" content="2" />
<meta name="Microsoft.Help.Locale" content="en-US" />
<meta name="Microsoft.Help.TopicLocale" content="en-US" />
<meta name="Microsoft.Help.DisplayVersion" content="Software Development Reference A 09/2022" />
<script language="javascript">
       
       if (window.parent.location.protocol != 'file:') {
				document.addEventListener('click', function(e) {
				    if (e.target) {
               if (e.target.nodeName == "A" ) {
                    if (!e.target.target) {
                      e.preventDefault();
                      e.stopPropagation();
                              
                      var origUrl = window.parent.location.href.substr(0, window.parent.location.href.indexOf("?"));
                      if (origUrl.length === 0) {
                          origUrl = window.parent.location.href;
                      }
                      var href= e.target.getAttribute("href");
                      var parts = href.split("#");
          
                      var url = "";
                      if (parts.length == 2 ) {
                        if (!parts[0].length) {
                            url = window.parent.location.search.replace('?','')
                        } else {
                            url = parts[0].replace('.html','');
                        }
                      } else {
                        url = parts[0].replace('.html','');
                      }

                      if (parts.length == 2) {
                          url += "#" + parts[1];
                      }
    
                      window.parent.location.href = origUrl + "?" + url;

                      return false;
                    }
               }
            }
				});
			}

		</script><script language="javascript">
         
         function copyContent(content, button) {
         
            var textArea = document.createElement("textarea");
            
            // Place in the top-left corner of screen regardless of scroll position.
            textArea.style.position = 'fixed';
            textArea.style.top = 0;
            textArea.style.left = 0;
            
            // Ensure it has a small width and height. Setting to 1px / 1em
            // doesn't work as this gives a negative w/h on some browsers.
            textArea.style.width = '2em';
            textArea.style.height = '2em';
            
            // We don't need padding, reducing the size if it does flash render.
            textArea.style.padding = 0;
            
            // Clean up any borders.
            textArea.style.border = 'none';
            textArea.style.outline = 'none';
            textArea.style.boxShadow = 'none';
            
            // Avoid flash of the white box if rendered for any reason.
            textArea.style.background = 'transparent';
            
            textArea.value = content;
            
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
               var successful = document.execCommand('copy');
               var msg = successful ? 'successful' : 'unsuccessful';
               if (!button.classList.contains("copied")){
                  button.textContent = "Copied";
                  button.classList.add("copied");
                  setTimeout(function(){
                     button.textContent = "Copy";
                     button.classList.remove("copied");
                  },1000);
               }
            } catch (err) {
               console.log('Oops, unable to copy');
            }
            
            document.body.removeChild(textArea);
         }
         
         function cpy(id, button) {
            var element = document.getElementById(id);
            var content = element.getAttribute("content");
            
            copyContent(content, button);
         }
         
         document.addEventListener("DOMContentLoaded", function(event) {
            document.querySelectorAll(".codeblock").forEach(function(elem) {
               elem.style.position = "relative";
               var copy = document.createElement("button");
               copy.textContent = "Copy";
               copy.setAttribute("class", "copy-code");
               
               var content = elem.textContent;
               
               copy.addEventListener("click", function(){
                  copyContent(content, copy);
               });
               
               elem.addEventListener("mouseenter", function(evt){
                  elem.prepend(copy);
               });
            });
            
            document.querySelectorAll(".codeblock").forEach(function(elem) {
               elem.addEventListener("mouseleave", function(evt){
                  document.querySelector(".copy-code").remove();
               });
            });
         });
         
      </script><script language="javascript">
          
          // Add the MathML namespace to html
          var html = document.getElementsByTagName("html")[0],
          head = document.getElementsByTagName("head")[0];
          
          var mathJax = document.createElement("script");
          mathJax.src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML";
          head.appendChild(mathJax);
          
          html.setAttribute("xmlns:m","http://www.w3.org/1998/Math/MathML");
          
          function inIframe() { try { return window.self !== window.top; } catch (e) { return true; } }
          
          if (!inIframe()) { 
          
          var Default = "index.html?GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC"; 
          
          var displaylocation = "value" + window.location.href;
          
          var GUIDS = displaylocation.split('GUID');          
          
          if (displaylocation.indexOf('#GUID') != -1) {            
          var First = GUIDS[1].split('.html');  
          if (GUIDS[3]){First = GUIDS[2].split('.html');}
          if (GUIDS[4]){First = GUIDS[3].split('.html');}
          if (GUIDS[5]){First = GUIDS[4].split('.html');}
          
          var Second = GUIDS[2].split('#');   
          if (GUIDS[3]){Second = GUIDS[3].split('#');}
          if (GUIDS[4]){Second = GUIDS[4].split('#');}
          if (GUIDS[5]){Second = GUIDS[5].split('#');}
          
          Default = "index.html?" + "GUID" + First[0] + "GUID" + Second[0];     
          }                    
          window.top.location = Default;
          }       
          
        </script><link rel="stylesheet" type="text/css" href="syntax-highlight.css" /><style xml:space="">
        
          button.copy-code{
            display:none;
            padding:0.7em 1.4em;
            margin:0 0.3em 0.3em 0;
            border-radius:0.15em;
            box-sizing: border-box;
            text-decoration:none;
            font-family:'Roboto',sans-serif;
            text-transform:uppercase;
            font-weight:400;
            color:#FFFFFF;
            background-color:#9c9c9c;
            box-shadow:inset 0 -0.6em 0 -0.35em rgba(0,0,0,0.17);
            text-align:center;
            position:relative;
            border: 0;
            float: right;
            border-radius: .5em;
            cursor: pointer;
          }
          button.copy-code:active{
            top:0.1em;
          }
          
          pre:hover button.copy-code{
            display: inline-block !important;
          }
          button.copy-code.copied {
            cursor: default !important;
          }
          
          
          @media all and (max-width:30em){
            button.copy-code{
              display:block;
              margin:0.4em auto;
            }
          }
        
        
      </style><link rel="stylesheet" type="text/css" href="syntax-highlight.css" /></head>
<body id="GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC">
<h1 class="title topictitle1" id="GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC__GUID-35A90F46-6F93-4C3E-BFC9-CEA535049039" style="">BLE Virtual Sniffer</h1><div class="body"><p class="p">This document explains how to use the MPLAB Code Configurator(MCC) framework to add BLE Virtual Sniffer system service component for capturing the HCI packets and feed it to the sniffer tool for debugging purposes.</p>
<p class="p"></p>
<div class="section" id="GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC__SECTION_BZR_5SF_RTB"><h2 class="title sectiontitle">Introduction</h2><p class="p">The BLE Virtual Sniffer uses BLE LOG middleware available as part of BLE Stack (BLE stack dependency) for restructuring of the HCI protocol packets. The BLE Virtual Sniffer has dependency of UART(To Output the HCI packet) which can be satisfied through Harmony CONSOLE system services.</p>
<div class="p"><br /><img class="image" id="GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC__IMAGE_SGZ_VQR_35B" src="GUID-64EE2F13-7CBB-4F0F-B976-D23A5B14CAB1-low.png" /><br /></div>
</div>
<div class="section" id="GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC__SECTION_CS5_2VF_RTB"><h2 class="title sectiontitle">Hardware Required</h2></div>
<div class="p">
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" id="GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC__TABLE_UWF_LFG_RTB" class="table" frame="border" border="1" rules="all"><caption><span class="tablecap"><span class="table--title-label">Table 1. </span></span></caption><col style="width:50%" /><col style="width:50%" /><thead class="thead" style="text-align:left;"><tr class="row"><th class="entry cellrowborder" style="vertical-align:middle;" id="d101712e35"><span><strong class="ph b">Tool</strong></span></th>
<th class="entry cellrowborder" style="vertical-align:middle;" id="d101712e38"><span><strong class="ph b">Qty</strong></span></th>
</tr>
</thead>
<tbody class="tbody"><tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d101712e35 "><span><span class="ph">WBZ451</span>Curiosity Board</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d101712e38 "><span>1</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d101712e35 "><span>Micro USB cable</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d101712e38 "><span>1</span></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC__SECTION_XJR_55F_RTB"><h2 class="title sectiontitle">SDK Setup</h2><ol class="ol" id="GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC__OL_D3W_PVF_RTB"><li class="li" id="GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC__GUID-B6A80C44-0F5C-470A-9756-6EE4FA990C22"><span class="indent-level-default">1.</span><p class="p"><a class="xref" href="GUID-2AD37FE2-1915-4E34-9A05-79E3810726D7.html" title="Steps to install IDE, compiler, tool chain, BLE, Zigbee stacks and application examples on your PC">Getting Started with Software Development</a></p>
</li>
</ol>
<p class="p"></p>
</div>
<div class="section" id="GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC__SECTION_ZM5_SVF_RTB"><h2 class="title sectiontitle">Software</h2><ol class="ol" id="GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC__OL_ZCL_TVF_RTB"><li class="li" id="GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC__GUID-C3C098A6-0C5D-42C9-9E3A-16077C068AC1"><span class="indent-level-default">1.</span><a class="xref" href="https://fte.com/support/WPS-download.aspx?demo=X240&amp;iid=X240" target="_blank">Wireless Protocol Suite(WPS)</a></li>
<li class="li" id="GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC__GUID-63CFB8CB-88E6-4DE2-BD9E-D15CCB1C7AB3"><span class="indent-level-default">2.</span><a class="xref" href="https://ww1.microchip.com/downloads/aemDocuments/documents/WSG/ProductDocuments/SoftwareTools/Microchip_BLE_Virtual_Sniffer_Tool_v1.00.zip" target="_blank">Microchip_BLE_Sniffer_Tool</a></li>
</ol>
<p class="p"></p>
</div>
<div class="section" id="GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC__SECTION_A5R_WWF_RTB"><h2 class="title sectiontitle">Developing an Application with BLE SNIFFER component using MPLAB Code Configurator(MCC)</h2><p class="p">This section explains the steps required by a user to integrate and use the BLE Virtual Sniffer component into any application.</p>
<p class="p"><strong class="ph b">Tip:</strong> New users of MPLAB Code Configurator (MCC) are recommended to go through the <a class="xref" href="https://onlinedocs.microchip.com/pr/GUID-1F7007B8-9A46-4D03-AEED-650357BA760D-en-US-6/index.html?GUID-B5D058F5-1D0B-4720-8649-ACE5C0EEE2C0" target="_blank">overview</a> of MCC. Users can add/remove different components like peripheral support and other wireless functionality by following steps mentioned <a class="xref" href="https://microchipdeveloper.com/mplabx:mcc" target="_blank">here</a>.</p>
<ol class="ol" id="GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC__OL_TJV_1ZF_RTB"><li class="li" id="GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC__GUID-C56D8E9D-7AD1-4C99-A197-A696C53E5D06"><span class="indent-level-default">1.</span>Create a new MCC Harmony Project -- <a class="xref" href="GUID-B86E8493-D00D-46EF-8624-D412342147F0.html">link</a> for instructions</li>
<li class="li" id="GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC__GUID-697FFA6B-75AA-431C-B32B-A99C4EAF06A8"><span class="indent-level-default">2.</span>Ensure that wireless_system_pic32cxbz2_wbz45 repo is available locally in the development repo.</li>
<li class="li" id="GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC__GUID-24EB0C1D-5089-4BA0-85CC-FD5AD4974492"><span class="indent-level-default">3.</span>Open MCC. The Wireless System Service components will be displayed in available Device Resources --&gt; Wireless --&gt; System Services as shown in the below figure.<div class="p"><br /><img class="image" id="GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC__IMAGE_C3Z_YQR_35B" src="GUID-7BDD9A5B-7D1B-4E50-98E4-D6BD292E7C76-low.png" /><br /></div>
</li>
<li class="li" id="GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC__GUID-CD36185F-9759-4717-919F-CBAF5F46E4AB"><span class="indent-level-default">4.</span><p class="p">Drag BLE SNIFFER component from Device Resources to project graph area and accept all Dependencies or satisfiers(auto-activation components), select "Yes".</p>
<div class="p"><br /><img class="image" id="GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC__IMAGE_UKD_CRR_35B" src="GUID-D6AFE23C-6F02-4740-AAEA-65534C3A0AFC-low.png" /><br /></div>
</li>
<li class="li" id="GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC__GUID-BFCFDCD8-AAC7-4261-8B17-7130B1A136E6"><span class="indent-level-default">5.</span>BLE SNIFFER will automatically enable the BLE LOG FEATURE(Enable BLE Log option) inside Ble stack as shown in the figure.<div class="p"><br /><img class="image" id="GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC__IMAGE_BH3_DRR_35B" src="GUID-4DAE7DFB-43FB-4626-B27B-6D3582DDB2B3-low.png" /><br /></div>
</li>
<li class="li" id="GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC__GUID-D537A08D-924F-40BB-A492-1CA46016E9F1"><span class="indent-level-default">6.</span>Connect the BLE SNIFFER with one of instances of SERCOM to satisfy the "UART" dependency of BLE SNIFFER.<div class="p"><br /><img class="image" id="GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC__IMAGE_PP4_FRR_35B" src="GUID-F34DCD30-4C4D-49D2-AEA8-98E9473B143B-low.png" /><br /></div>
</li>
<li class="li" id="GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC__GUID-C50CCF78-392C-4FD2-BC23-68B5C47A26A1"><span class="indent-level-default">7.</span>Ensure that the Transmit pinout and Receive pinout settings are configured properly inside SERCOM plib configuration options as shown in the figure.<div class="p"><br /><img class="image" id="GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC__IMAGE_ODY_GRR_35B" src="GUID-34AFCE38-5308-47B1-B5F3-AF90D800279E-low.png" /><br /></div>
<p class="p"><strong class="ph b">NOTE:</strong> Please refer device data sheet for pin and pad configurations.</p>
</li>
<li class="li" id="GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC__GUID-9B8A73FC-CA20-466D-9852-BCB7C258DE25"><span class="indent-level-default">8.</span>Generate the code. Refer <a class="xref" href="GUID-9C28F407-4879-4174-9963-2CF34161398E.html">link</a> for more details.</li>
<li class="li" id="GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC__GUID-10C3A87B-24DE-4F63-A908-6546044A3692"><span class="indent-level-default">9.</span>After generating the program source from MCC interface by clicking Generate Code, the BLE LOG application service can be found in the following project directories.<div class="p"><br /><img class="image" id="GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC__IMAGE_JYT_3RR_35B" src="GUID-6A37F064-FD31-41E9-AB8D-8786BA71E8C7-low.png" /><br /></div>
</li>
<li class="li" id="GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC__GUID-1F1E3CB2-5B5D-47B8-B9B1-55791FED86B1"><span class="indent-level-default">10.</span>Compile and Run the project in WBZ45x device.<p class="p"></p>
</li>
</ol>
</div>
<div class="section" id="GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC__SECTION_FVD_X1G_RTB"><h2 class="title sectiontitle">Capturing and Parsing the HCI Sniffer Packets through Microchip BLE Sniffer Tool</h2><div class="p"><ol class="ol" id="GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC__OL_IKJ_Y1G_RTB"><li class="li" id="GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC__GUID-D5CB6DC8-1657-432E-BA06-BC400FA06CA5"><span class="indent-level-default">1.</span>Make sure to install Wireless Protocol Suite.</li>
<li class="li" id="GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC__GUID-FCEEBED7-6716-4192-A0DD-1C37BF608E46"><span class="indent-level-default">2.</span>open the WPS installed location and copy the following files as shown in the figure.<div class="p"><ol class="ol" type="a" id="GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC__OL_DVB_HBG_RTB"><li class="li" id="GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC__GUID-05055490-7B56-4D08-94EA-A090895D8920"><span class="indent-level-default">1.</span><strong class="ph b">liveimport</strong> and <strong class="ph b">LiveImportAPI.dll </strong>(available inside Executables-&gt;core as part of WPS installation).</li>
<li class="li" id="GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC__GUID-3E3150C4-1E2C-4270-B97B-10A11C76FA98"><span class="indent-level-default">2.</span><strong class="ph b">Microchip_BLE_Sniffer_Tool</strong> (available in the link in software section).<div class="p"><br /><img class="image" id="GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC__IMAGE_HK4_KRR_35B" src="GUID-CD58CB42-52B2-47D7-8851-8AEF09BC1FD6-low.png" /><br /></div>
</li>
</ol>
</div>
</li>
<li class="li" id="GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC__GUID-7E9BA568-6AC0-470E-998C-6BCCEB749285"><span class="indent-level-default">3.</span> Open command prompt from the WPS installed location and run Microchip_BLE_Sniffer_Tool using the following command Microchip_BLE_Virtual_Sniffer_Tool.exe &lt;"com_port"&gt; &lt;"Baud_Rate"&gt; (eg: Microchip_BLE_Virtual_Sniffer_Tool 23 921600) as shown in the figure.<p class="p"><strong class="ph b">NOTE:</strong>It is recommended to Configure the Virtual sniffer SERCOM at highest Baud Rate(921600) and is fixed to 921600 for efficient usage of the sniffer.</p>
<div class="p"><br /><img class="image" id="GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC__IMAGE_A2P_MRR_35B" src="GUID-457D311D-9004-4874-B5DD-1C60B9A4129E-low.png" /><br /></div>
</li>
<li class="li" id="GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC__GUID-766682A4-7370-444C-9E52-39CC43D63D71"><span class="indent-level-default">4.</span>Open WPS tool and virtual sniffing data capture option in the startup page and start record as shown in the figure below.<div class="p"><br /><img class="image" id="GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC__IMAGE_NQQ_YRR_35B" src="GUID-A4B316A8-BAB0-4458-AD14-92B2EF34B907-low.png" /><br /></div>
<p class="p"></p>
<br /><img class="image" id="GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC__IMAGE_LN2_1SR_35B" src="GUID-F4F3D8C3-9711-4729-B276-95777458CC40-low.png" /><br /></li>
<li class="li" id="GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC__GUID-49BA3649-7F1F-4A13-A500-8D1CFA6BF1C2"><span class="indent-level-default">5.</span>Reset the <span class="ph">WBZ451</span> device and the captured packet will appear in WPS Tool and the total number HCI packets captured will be displayed in the Microchip_BLE_Sniffer_Tool command prompt as shown in the figure.<div class="p"><br /><img class="image" id="GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC__IMAGE_AQ4_BSR_35B" src="GUID-D24CA307-E125-4C84-977D-CC99EFB2A182-low.png" /><br /></div>
<div class="p"><br /><img class="image" id="GUID-71834715-4833-43ED-A1ED-A2A72DDE48BC__IMAGE_IMQ_CSR_35B" src="GUID-6FC1AC8F-498C-4022-9DA1-2E82EFB16370-low.png" /><br /></div>
</li>
</ol>
</div>
</div>
</div>
<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="GUID-3CC3561E-252E-43B9-BC8A-47DD108A0A46.html" title="Documentation describing steps to test and develop the precompiled BLE application examples">BLE Applications</a></div>
</div>
</div></body>
</html>