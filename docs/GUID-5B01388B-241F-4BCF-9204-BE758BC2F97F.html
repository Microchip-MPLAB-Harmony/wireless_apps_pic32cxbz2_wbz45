<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE11" /><meta name="copyright" content="(C) Copyright 2022" />
<meta name="DC.rights.owner" content="(C) Copyright 2022" />
<meta name="DC.type" content="topic" />
<meta name="DC.title" content="BLE OTA DFU Demo" />
<meta name="DC.relation" scheme="URI" content="GUID-908446A4-F490-4063-9096-66C4831F9BE4.html" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F" />
<meta name="DC.language" content="en-US" />
<link rel="stylesheet" type="text/css" href="stylesheets/atmel.css" />
<title>BLE OTA DFU Demo</title>
<meta name="Microsoft.Help.Id" content="GUID-A5330D3A-9F51-4A26-B71D-8503A493DF9C-GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F" />
<meta name="Microsoft.Help.TocParent" content="GUID-A5330D3A-9F51-4A26-B71D-8503A493DF9C-GUID-908446A4-F490-4063-9096-66C4831F9BE4" />
<meta name="Microsoft.Help.TocOrder" content="6" />
<meta name="Microsoft.Help.Locale" content="en-US" />
<meta name="Microsoft.Help.TopicLocale" content="en-US" />
<meta name="Microsoft.Help.DisplayVersion" content="Software Development Reference 1 02/2022" />
<script language="javascript">
       
       if (window.parent.location.protocol != 'file:') {
				document.addEventListener('click', function(e) {
				    if (e.target) {
               if (e.target.nodeName == "A" ) {
                    if (!e.target.target) {
                      e.preventDefault();
                      e.stopPropagation();
                              
                      var origUrl = window.parent.location.href.substr(0, window.parent.location.href.indexOf("?"));
                      if (origUrl.length === 0) {
                          origUrl = window.parent.location.href;
                      }
                      var href= e.target.getAttribute("href");
                      var parts = href.split("#");
          
                      var url = "";
                      if (parts.length == 2 ) {
                        if (!parts[0].length) {
                            url = window.parent.location.search.replace('?','')
                        } else {
                            url = parts[0].replace('.html','');
                        }
                      } else {
                        url = parts[0].replace('.html','');
                      }

                      if (parts.length == 2) {
                          url += "#" + parts[1];
                      }
    
                      window.parent.location.href = origUrl + "?" + url;

                      return false;
                    }
               }
            }
				});
			}

		</script><script language="javascript">
         
         function copyContent(content, button) {
         
            var textArea = document.createElement("textarea");
            
            // Place in the top-left corner of screen regardless of scroll position.
            textArea.style.position = 'fixed';
            textArea.style.top = 0;
            textArea.style.left = 0;
            
            // Ensure it has a small width and height. Setting to 1px / 1em
            // doesn't work as this gives a negative w/h on some browsers.
            textArea.style.width = '2em';
            textArea.style.height = '2em';
            
            // We don't need padding, reducing the size if it does flash render.
            textArea.style.padding = 0;
            
            // Clean up any borders.
            textArea.style.border = 'none';
            textArea.style.outline = 'none';
            textArea.style.boxShadow = 'none';
            
            // Avoid flash of the white box if rendered for any reason.
            textArea.style.background = 'transparent';
            
            textArea.value = content;
            
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
               var successful = document.execCommand('copy');
               var msg = successful ? 'successful' : 'unsuccessful';
               if (!button.classList.contains("copied")){
                  button.textContent = "Copied";
                  button.classList.add("copied");
                  setTimeout(function(){
                     button.textContent = "Copy";
                     button.classList.remove("copied");
                  },1000);
               }
            } catch (err) {
               console.log('Oops, unable to copy');
            }
            
            document.body.removeChild(textArea);
         }
         
         function cpy(id, button) {
            var element = document.getElementById(id);
            var content = element.getAttribute("content");
            
            copyContent(content, button);
         }
         
         document.addEventListener("DOMContentLoaded", function(event) {
            document.querySelectorAll(".codeblock").forEach(function(elem) {
               elem.style.position = "relative";
               var copy = document.createElement("button");
               copy.textContent = "Copy";
               copy.setAttribute("class", "copy-code");
               
               var content = elem.textContent;
               
               copy.addEventListener("click", function(){
                  copyContent(content, copy);
               });
               
               elem.addEventListener("mouseenter", function(evt){
                  elem.prepend(copy);
               });
            });
            
            document.querySelectorAll(".codeblock").forEach(function(elem) {
               elem.addEventListener("mouseleave", function(evt){
                  document.querySelector(".copy-code").remove();
               });
            });
         });
         
      </script><script language="javascript">
          
          // Add the MathML namespace to html
          var html = document.getElementsByTagName("html")[0],
          head = document.getElementsByTagName("head")[0];
          
          var mathJax = document.createElement("script");
          mathJax.src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML";
          head.appendChild(mathJax);
          
          html.setAttribute("xmlns:m","http://www.w3.org/1998/Math/MathML");
          
          function inIframe() { try { return window.self !== window.top; } catch (e) { return true; } }
          
          if (!inIframe()) { 
          
          var Default = "index.html?GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F"; 
          
          var displaylocation = "value" + window.location.href;
          
          var GUIDS = displaylocation.split('GUID');          
          
          if (displaylocation.indexOf('#GUID') != -1) {            
          var First = GUIDS[1].split('.html');  
          if (GUIDS[3]){First = GUIDS[2].split('.html');}
          if (GUIDS[4]){First = GUIDS[3].split('.html');}
          if (GUIDS[5]){First = GUIDS[4].split('.html');}
          
          var Second = GUIDS[2].split('#');   
          if (GUIDS[3]){Second = GUIDS[3].split('#');}
          if (GUIDS[4]){Second = GUIDS[4].split('#');}
          if (GUIDS[5]){Second = GUIDS[5].split('#');}
          
          Default = "index.html?" + "GUID" + First[0] + "GUID" + Second[0];     
          }                    
          window.top.location = Default;
          }       
          
        </script><link rel="stylesheet" type="text/css" href="syntax-highlight.css" /><style xml:space="">
        
          button.copy-code{
            display:none;
            padding:0.7em 1.4em;
            margin:0 0.3em 0.3em 0;
            border-radius:0.15em;
            box-sizing: border-box;
            text-decoration:none;
            font-family:'Roboto',sans-serif;
            text-transform:uppercase;
            font-weight:400;
            color:#FFFFFF;
            background-color:#9c9c9c;
            box-shadow:inset 0 -0.6em 0 -0.35em rgba(0,0,0,0.17);
            text-align:center;
            position:relative;
            border: 0;
            float: right;
            border-radius: .5em;
            cursor: pointer;
          }
          button.copy-code:active{
            top:0.1em;
          }
          
          pre:hover button.copy-code{
            display: inline-block !important;
          }
          button.copy-code.copied {
            cursor: default !important;
          }
          
          
          @media all and (max-width:30em){
            button.copy-code{
              display:block;
              margin:0.4em auto;
            }
          }
        
        
      </style><link rel="stylesheet" type="text/css" href="syntax-highlight.css" /></head>
<body id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F">
<h1 class="title topictitle1" id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F__GUID-E87ED723-9B50-472B-884E-1BF45AD29F8B">BLE OTA DFU Demo</h1><div class="body"><p class="p">The below BLE OTA demo steps are common for any application implementing OTA functionality.</p>
<p class="p">BLE sensor application is the sample project which implements OTA functioanlity as explained in
            the above steps. The current image (ble_sensor.X.production.signed.unified_gpiobased.hex
            or ble_sensor.X.production.signed.unified_timerbased.hex) with OTA capability and new
            upgrdable .bin (ble_sensor_1.0.0.1_enc_ota.bin) is also available in
            \ble\advanced_applications\ble_sensor\precompiled_hex for your reference.</p>
<ul class="ul"><li class="li" id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F__GUID-3CBEE913-0ED1-4D5B-A3EA-78D93CDFB2A0"><p class="p"><strong class="ph b">Hardware Required:</strong></p>
</li>
</ul>

<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F__GUID-D9C266DA-00D1-4D7D-A911-8D770C585936" class="table" frame="void" border="1" rules="all"><col style="width:50%" /><col style="width:50%" /><tbody class="tbody"><tr class="row"><td class="entry cellrowborder" style="vertical-align:top;"><span><p class="p"><strong class="ph b">Tool</strong></p>
</span></td>
<td class="entry row-nocellborder" style="vertical-align:top;"><span><p class="p"><strong class="ph b">Qty</strong></p>
</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:top;"><span>
                            <span class="ph">WBZ451</span>  Curiosity Board</span></td>
<td class="entry row-nocellborder" style="text-align:right;vertical-align:top;"><span><p class="p">1</p>
</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:top;"><span><p class="p">Micro USB cable</p>
</span></td>
<td class="entry row-nocellborder" style="text-align:right;vertical-align:top;"><span><p class="p">1</p>
</span></td>
</tr>
<tr class="row"><td class="entry cell-norowborder" style="vertical-align:top;"><span><p class="p">Android/iOS Mobile</p>
</span></td>
<td class="entry nocellnorowborder" style="text-align:right;vertical-align:top;"><span><p class="p">1</p>
</span></td>
</tr>
</tbody>
</table>
</div>
<ul class="ul"><li class="li" id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F__GUID-9E5BF959-026A-4DF1-8976-DA207BCA80AE"><p class="p"><strong class="ph b">Smartphone App:</strong> Microchip Bluetooth Data (MBD) iOS/Android app available in stores</p>
</li>
</ul>
<ul class="ul"><li class="li" id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F__GUID-EC52AA97-6689-4FEB-8304-089BFE5324CC">
                <p class="p"><strong class="ph b">Demo steps:</strong></p>

                <ol class="ol" id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F__OL_X2M_5D2_25B">
                    <li class="li" id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F__GUID-34B2B7DD-CD73-4C3D-AB0D-9D5AC6072780"><span class="indent-level-default">a.</span>To perform the OTAU, the upgradable firmware bin file created in "<a class="xref" href="GUID-6816EA2C-EDCC-48EC-9D99-BF8EAF56C5A1.html">Upgradable image .bin file generation</a>" to be stored into MBD
                        app. Send the upgrdable bin file to your mail. Follow the below screenshots
                        to store the image received on mail into MBD app. <ul class="ul" id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F__UL_SWN_DH3_25B">
                            <li class="li" id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F__GUID-08E511B5-A90E-4299-834F-A17FBC0E00DF"><strong class="ph b">iOS Mobile:</strong></li>

                        </ul>
<div class="fig fignone" id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F__FIG_DTX_BF2_25B">
                            <br /><img class="image" id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F__IMAGE_ETX_BF2_25B" src="GUID-FC5154AA-EDA4-49BC-8CAE-0D7FCBE700CD-low.jpg" /><br />
                        </div>
<div class="fig fignone" id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F__FIG_FTX_BF2_25B">
                            <img class="image" id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F__IMAGE_GTX_BF2_25B" src="GUID-0FCDE405-857D-4E07-854D-B5F1263FE1FF-low.jpg" />
                        </div>
<div class="fig fignone" id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F__FIG_HTX_BF2_25B">
                            <img class="image" id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F__IMAGE_ITX_BF2_25B" src="GUID-2FC7794B-C1EC-46D9-BCCD-EBF729ECF1F7-low.jpg" />
                        </div>
<div class="fig fignone" id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F__FIG_JTX_BF2_25B">
                            <img class="image" id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F__IMAGE_KTX_BF2_25B" src="GUID-9B87E2A3-2423-4223-9347-F01F428A9E3A-low.jpg" />
                        </div>
<ul class="ul" id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F__UL_CTX_BF2_25B">
                            <li class="li" id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F__GUID-16245946-09F3-41B1-A45F-CF3783D09E3E">
                                <div class="p"><strong class="ph b">Android Mobile:</strong><br /><img class="image" id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F__IMAGE_LTX_BF2_25B" src="GUID-472BC8F0-D4BB-4B5E-93AA-FB67C1EAE6BE-low.jpg" /><br /></div>

                            </li>

                        </ul>
<div class="fig fignone" id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F__FIG_MTX_BF2_25B">
                            <br /><img class="image" id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F__IMAGE_NTX_BF2_25B" src="GUID-19DF5F03-6FCC-4C3A-A90E-65EE94B6BD4B-low.jpg" /><br />
                            <p class="p"> </p>

                        </div>
<div class="fig fignone" id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F__FIG_OTX_BF2_25B">
                            <br /><img class="image" id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F__IMAGE_PTX_BF2_25B" src="GUID-67360FEE-06B0-4B25-8658-4A0406C05F04-low.jpg" /><br />
                        </div>
</li>

                    <li class="li" id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F__GUID-F6AFD59F-89BC-4678-8FDE-946F97DCACDB"><span class="indent-level-default">b.</span>Turn on mobile Bluetooth and select <strong class="ph b">“OTA DFU"</strong> tab of Microchip
                        Bluetooth Data App on the mobile device.<div class="fig fignone" id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F__GUID-E1C3862F-38FB-43DE-AF2F-05BBFF2D882B">
                            <img class="image" id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F__IMAGE_DJB_R22_25B" src="GUID-B60BAA4E-62D1-4C60-8DCE-A5E19DF995A9-low.jpg" />
                        </div>
</li>

                    <li class="li" id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F__GUID-2BF3EAD7-CC01-4245-9E1D-7B69C0FF3499"><span class="indent-level-default">c.</span>Power On the OTA capable target device ( <span class="ph">PIC32CXBZ2</span>/<span class="ph">WBZ451</span> ) which was programmed
                        in "<a class="xref" href="GUID-436FCDB1-1B96-4B4C-802C-0C61967DA657.html">Programming the Application using MPLABX IDE</a>". Device will be
                        advertising. Click on "SCAN" button in mobile app and the device be visible
                        in scanned list. <br /><img class="image" id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F__IMAGE_OCQ_KF2_25B" src="GUID-295AF63F-EB80-4945-8CEC-266471708733-low.jpg" /><br /></li>

                    <li class="li" id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F__GUID-C12494B1-8B77-4BA3-9E0B-73D6079576D6"><span class="indent-level-default">d.</span>Click on intended device from the scanned list. Mobile app will now get
                        connected with OTA Target device. "Connected" message will appear for a
                        short while.<br /><img class="image" id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F__IMAGE_FCQ_XF2_25B" src="GUID-AB0A1925-9937-4F59-8720-62812984E45A-low.jpg" /><br /></li>

                    <li class="li" id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F__GUID-38D5D668-351B-41DE-B448-669499A9175B"><span class="indent-level-default">e.</span>Click the ‘Select Image’ option to choose the available firmware file.<div class="fig fignone" id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F__GUID-2CBD0657-BC11-4239-9CC2-189C33BE0509">
                            <br /><img class="image" id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F__IMAGE_T2F_1G2_25B" src="GUID-62D64D73-0E12-4FB0-8DCA-778CB117E24C-low.jpg" /><br />
                        </div>
</li>

                    <li class="li" id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F__GUID-7FBF7F5F-93A8-4DFE-B285-1526D120F029"><span class="indent-level-default">f.</span>The OTAU firmware image file copied in the step 1 will be visible on screen.
                        Click on that image.<div class="fig fignone" id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F__GUID-9968DBBD-A750-486A-9A54-7614F6FD1ECF">
                            <br /><img class="image" id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F__IMAGE_TWV_2G2_25B" src="GUID-819F82DC-2E63-411A-99DD-65DA02E73384-low.jpg" /><br />
                        </div>
</li>

                    <li class="li" id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F__GUID-B1D0A394-6823-4508-9D70-6CE04EB67C66"><span class="indent-level-default">g.</span>After confirming the FW version press OK button. <br /><img class="image" id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F__IMAGE_L1V_GG2_25B" src="GUID-4B8CA7C7-7FCA-429E-A62E-E08F788EFF08-low.jpg" /><br /></li>

                    <li class="li" id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F__GUID-34D2B7BC-7B82-4633-B5F4-B37802DF86E7"><span class="indent-level-default">h.</span>Firmware update will be initiated and the progress will be shown in mobile
                        app. The process would take few seconds. <br /><img class="image" id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F__IMAGE_NPP_3G2_25B" src="GUID-8592457D-579A-4963-9599-EE060416DB49-low.jpg" /><br /></li>

                    <li class="li" id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F__GUID-840490DC-5858-4C10-87F4-7856BE7D59B5"><span class="indent-level-default">i.</span>Once the complete image is transferred, "OTA Update successfully" status
                        will be shown in mobile app. Click on "OK" and then device will perform
                        authentication of the image. If validation is successful, then system reboot
                            automatically.<div class="fig fignone" id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F__GUID-C8D5F4DB-A78C-4EE1-95D9-F8E8877EF81B">
                            <br /><img class="image" id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F__IMAGE_YGP_PG2_25B" src="GUID-ABA6E054-C7D8-43F2-97FA-BA778F6B3942-low.jpg" /><br />
                        </div>
<div class="fig fignone" id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F__GUID-2B4F6AA9-5F61-4D7D-99AB-3FEEC8C39AB3">
                            <br /><img class="image" id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F__IMAGE_ZGP_PG2_25B" src="GUID-B378692B-4EE5-4DCD-AB09-3AEB2F01F506-low.jpg" /><br />
                        </div>
</li>

                    <li class="li" id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F__GUID-620CB9D3-6485-4635-9403-EC8DC9391B8C"><span class="indent-level-default">j.</span>On bootup, device does the authentication of new image in Slot1 and then
                        copies the new image to Slot0. Now the new image will be running from
                        Slot0.</li>

                    <li class="li" id="GUID-5B01388B-241F-4BCF-9204-BE758BC2F97F__GUID-216DA10C-066B-44DE-86B4-5A0944E47058"><span class="indent-level-default">k.</span>To verify whether the running image on the target is newly upgraded image,
                        follow steps 2 to 7 and check the current version.</li>

                </ol>

            </li>
</ul>
<p class="p"></p>
</div>
<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="GUID-908446A4-F490-4063-9096-66C4831F9BE4.html">Device Firmware Upgrade Over BLE</a></div>
</div>
</div></body>
</html>