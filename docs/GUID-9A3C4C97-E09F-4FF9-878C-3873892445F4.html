<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE11" /><meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="DC.type" content="topic" />
<meta name="DC.title" content="BLE Extended Advertisements" />
<meta name="DC.relation" scheme="URI" content="GUID-B3B46369-F5B4-401B-8405-658BE34988F4.html" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4" />
<meta name="DC.language" content="en-US" />
<link rel="stylesheet" type="text/css" href="stylesheets/atmel.css" />
<title>BLE Extended Advertisements</title>
<meta name="Microsoft.Help.Id" content="GUID-A5330D3A-9F51-4A26-B71D-8503A493DF9C-GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4" />
<meta name="Microsoft.Help.TocParent" content="GUID-A5330D3A-9F51-4A26-B71D-8503A493DF9C-GUID-B3B46369-F5B4-401B-8405-658BE34988F4" />
<meta name="Microsoft.Help.TocOrder" content="2" />
<meta name="Microsoft.Help.Locale" content="en-US" />
<meta name="Microsoft.Help.TopicLocale" content="en-US" />
<meta name="Microsoft.Help.DisplayVersion" content="Software Development Reference A 09/2022" />
<script language="javascript">
       
       if (window.parent.location.protocol != 'file:') {
				document.addEventListener('click', function(e) {
				    if (e.target) {
               if (e.target.nodeName == "A" ) {
                    if (!e.target.target) {
                      e.preventDefault();
                      e.stopPropagation();
                              
                      var origUrl = window.parent.location.href.substr(0, window.parent.location.href.indexOf("?"));
                      if (origUrl.length === 0) {
                          origUrl = window.parent.location.href;
                      }
                      var href= e.target.getAttribute("href");
                      var parts = href.split("#");
          
                      var url = "";
                      if (parts.length == 2 ) {
                        if (!parts[0].length) {
                            url = window.parent.location.search.replace('?','')
                        } else {
                            url = parts[0].replace('.html','');
                        }
                      } else {
                        url = parts[0].replace('.html','');
                      }

                      if (parts.length == 2) {
                          url += "#" + parts[1];
                      }
    
                      window.parent.location.href = origUrl + "?" + url;

                      return false;
                    }
               }
            }
				});
			}

		</script><script language="javascript">
         
         function copyContent(content, button) {
         
            var textArea = document.createElement("textarea");
            
            // Place in the top-left corner of screen regardless of scroll position.
            textArea.style.position = 'fixed';
            textArea.style.top = 0;
            textArea.style.left = 0;
            
            // Ensure it has a small width and height. Setting to 1px / 1em
            // doesn't work as this gives a negative w/h on some browsers.
            textArea.style.width = '2em';
            textArea.style.height = '2em';
            
            // We don't need padding, reducing the size if it does flash render.
            textArea.style.padding = 0;
            
            // Clean up any borders.
            textArea.style.border = 'none';
            textArea.style.outline = 'none';
            textArea.style.boxShadow = 'none';
            
            // Avoid flash of the white box if rendered for any reason.
            textArea.style.background = 'transparent';
            
            textArea.value = content;
            
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
               var successful = document.execCommand('copy');
               var msg = successful ? 'successful' : 'unsuccessful';
               if (!button.classList.contains("copied")){
                  button.textContent = "Copied";
                  button.classList.add("copied");
                  setTimeout(function(){
                     button.textContent = "Copy";
                     button.classList.remove("copied");
                  },1000);
               }
            } catch (err) {
               console.log('Oops, unable to copy');
            }
            
            document.body.removeChild(textArea);
         }
         
         function cpy(id, button) {
            var element = document.getElementById(id);
            var content = element.getAttribute("content");
            
            copyContent(content, button);
         }
         
         document.addEventListener("DOMContentLoaded", function(event) {
            document.querySelectorAll(".codeblock").forEach(function(elem) {
               elem.style.position = "relative";
               var copy = document.createElement("button");
               copy.textContent = "Copy";
               copy.setAttribute("class", "copy-code");
               
               var content = elem.textContent;
               
               copy.addEventListener("click", function(){
                  copyContent(content, copy);
               });
               
               elem.addEventListener("mouseenter", function(evt){
                  elem.prepend(copy);
               });
            });
            
            document.querySelectorAll(".codeblock").forEach(function(elem) {
               elem.addEventListener("mouseleave", function(evt){
                  document.querySelector(".copy-code").remove();
               });
            });
         });
         
      </script><script language="javascript">
          
          // Add the MathML namespace to html
          var html = document.getElementsByTagName("html")[0],
          head = document.getElementsByTagName("head")[0];
          
          var mathJax = document.createElement("script");
          mathJax.src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML";
          head.appendChild(mathJax);
          
          html.setAttribute("xmlns:m","http://www.w3.org/1998/Math/MathML");
          
          function inIframe() { try { return window.self !== window.top; } catch (e) { return true; } }
          
          if (!inIframe()) { 
          
          var Default = "index.html?GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4"; 
          
          var displaylocation = "value" + window.location.href;
          
          var GUIDS = displaylocation.split('GUID');          
          
          if (displaylocation.indexOf('#GUID') != -1) {            
          var First = GUIDS[1].split('.html');  
          if (GUIDS[3]){First = GUIDS[2].split('.html');}
          if (GUIDS[4]){First = GUIDS[3].split('.html');}
          if (GUIDS[5]){First = GUIDS[4].split('.html');}
          
          var Second = GUIDS[2].split('#');   
          if (GUIDS[3]){Second = GUIDS[3].split('#');}
          if (GUIDS[4]){Second = GUIDS[4].split('#');}
          if (GUIDS[5]){Second = GUIDS[5].split('#');}
          
          Default = "index.html?" + "GUID" + First[0] + "GUID" + Second[0];     
          }                    
          window.top.location = Default;
          }       
          
        </script><link rel="stylesheet" type="text/css" href="syntax-highlight.css" /><style xml:space="">
        
          button.copy-code{
            display:none;
            padding:0.7em 1.4em;
            margin:0 0.3em 0.3em 0;
            border-radius:0.15em;
            box-sizing: border-box;
            text-decoration:none;
            font-family:'Roboto',sans-serif;
            text-transform:uppercase;
            font-weight:400;
            color:#FFFFFF;
            background-color:#9c9c9c;
            box-shadow:inset 0 -0.6em 0 -0.35em rgba(0,0,0,0.17);
            text-align:center;
            position:relative;
            border: 0;
            float: right;
            border-radius: .5em;
            cursor: pointer;
          }
          button.copy-code:active{
            top:0.1em;
          }
          
          pre:hover button.copy-code{
            display: inline-block !important;
          }
          button.copy-code.copied {
            cursor: default !important;
          }
          
          
          @media all and (max-width:30em){
            button.copy-code{
              display:block;
              margin:0.4em auto;
            }
          }
        
        
      </style><link rel="stylesheet" type="text/css" href="syntax-highlight.css" /></head>
<body id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4">
<h1 class="title topictitle1" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__GUID-53A17F36-E8C1-4602-820E-FD45BC81673C" style="">BLE Extended Advertisements</h1><div class="body"><p class="p"> <a class="xref" href="GUID-17DABF04-E5D8-4201-A746-2FC244450A19.html">Getting Started</a></p>
<p class="p"> <a class="xref" href="GUID-B3B46369-F5B4-401B-8405-658BE34988F4.html">Getting Started with Peripheral Building Blocks</a></p>
<p class="p"> <a class="xref" href="GUID-E1A0E9CA-311E-4F53-9C27-160173609975.html">Adding UART</a> <strong class="ph b">--&gt;</strong> <a class="xref" href="#GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4">Extended Advertisements</a></p>
<div class="section" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__INTRODUCTION"><h2 class="title sectiontitle">Introduction</h2><p class="p">This document will help users enable Extended Advertisements (1M, 2M, coded PHY -- 125kbps) on <span class="ph">WBZ451</span> Curiosity Board. This example (ext_adv) enables users to send application data using extended advertisements. Extended Advertisements are used to send more data than the legacy advertisements allow and allow long range functionality when using Coded PHY. Use of Extended Advertisements also enables the users to select between different PHYs (1M, 2M and <strong class="ph b">LE Coded</strong>) which are not permitted when using legacy advertisements. In BLE a peripheral or broadcaster always starts with advertisements. Advertisement packets enable a central or observer to discover a peripheral or broadcaster.</p>
<p class="p">Extended Advertisements implemented in this example can be used for sending more data (2M PHY) or do range tests (Coded PHY). For testing these features a scanner Application can be used which is configured to scan the extended advertisement packets.</p>
<p class="p">To save power, low power mode can be enabled. If conditions are met then <span class="ph">WBZ451</span> will enter into sleep mode. Details will be discussed in later section.</p>
<p class="p">Users can run the precompiled Application Example hex file provided with this example on the <span class="ph">WBZ451</span> Curiosity Board and go through the steps involved in developing this Application application from the scratch</p>
<p class="p">These examples each build on top on one and other. We strongly recommend that you follow the examples in order, to learn the basics concepts before progressing to the more advanced topics.</p>
</div>
<div class="section" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__RECOMMENDED-READS"><h2 class="title sectiontitle">Recommended Reads</h2><ol class="ol" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__GUID-A13DA53A-0DD0-44AF-B42E-06C060B03F23"><li class="li" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__GUID-8D2B400F-CE9D-4566-8805-433A7564624D"><span class="indent-level-default">1.</span><p class="p"><a class="xref" href="https://onlinedocs.microchip.com/pr/GUID-C5EAF60E-9124-427C-A0F1-F2DBE662EA92-en-US-1/index.html?GUID-222749FE-01C5-43B6-A5C7-CD82B3FC7F5F" target="_blank">BLE Software Specification</a></p>
</li>
<li class="li" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__GUID-8D2B400F-CE9D-4566-8805-433A7564624D"><span class="indent-level-default">2.</span><p class="p"></p>
</li>
<li class="li" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__GUID-8D2B400F-CE9D-4566-8805-433A7564624D"><span class="indent-level-default">3.</span><p class="p"><a class="xref" href="GUID-AB1A02BF-4F9B-4058-90D9-02BFB3136682.html">FreeRtos BLE App Initialize</a></p>
</li>
<li class="li" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__GUID-0B2B1691-326F-4193-992D-9CDA22B94EC8"><span class="indent-level-default">4.</span><p class="p"> <a class="xref" href="GUID-E1A0E9CA-311E-4F53-9C27-160173609975.html">Adding UART</a></p>
</li>
<li class="li" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__GUID-FF962FED-73CE-47D7-B320-0CC0F99C3770"><span class="indent-level-default">5.</span><p class="p"> <a class="xref" href="GUID-994B6462-D0F1-4B8C-A97B-A9CBF20426C2.html">Low Power Details</a></p>
</li>
</ol>
</div>
<div class="section" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__HARDWARE-REQUIRED"><h2 class="title sectiontitle">Hardware Required</h2>
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__GUID-1469847B-C495-4753-939B-97684A8FE767" class="table" frame="border" border="1" rules="all"><col style="width:" /><col style="width:" /><thead class="thead" style="text-align:left;"><tr class="row"><th class="entry cellrowborder" style="vertical-align:middle;" id="d30708e97"><span> <strong class="ph b">Tool</strong></span></th>
<th class="entry cellrowborder" style="vertical-align:middle;" id="d30708e101"><span> <strong class="ph b">Qty</strong></span></th>
</tr>
</thead>
<tbody class="tbody"><tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d30708e97 "><span><span class="ph">WBZ451</span> Curiosity Board</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d30708e101 "><span>1 (2 if testing with a scanner)</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d30708e97 "><span>Micro USB cable</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d30708e101 "><span>1</span></td>
</tr>
</tbody>
</table>
</div>
<p class="p">Optional <a class="xref" href="https://www.microchip.com/en-us/development-tool/ATPOWERDEBUGGER" target="_blank">Power Debugger</a>/Multimeter/OscilloScope to measure power.</p>
</div>
<div class="section" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__SDK-SETUP"><h2 class="title sectiontitle">SDK Setup</h2><ol class="ol" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__GUID-A0C47662-C373-489B-AA42-BD9071F76410"><li class="li" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__GUID-AA4DC425-6070-4AA4-ACFD-23B3EC0BC1E9"><span class="indent-level-default">1.</span><p class="p"><a class="xref" href="GUID-2AD37FE2-1915-4E34-9A05-79E3810726D7.html" title="Steps to install IDE, compiler, tool chain, BLE, Zigbee stacks and application examples on your PC">Getting Started with Software Development</a></p>
</li>
</ol>
</div>
<div class="section" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__SOFTWARE"><h2 class="title sectiontitle">Software</h2><ol class="ol" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__GUID-3BA1DB50-991E-4EDF-86E6-58BC84154EA6"><li class="li" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__GUID-0F0C3973-98CF-4D96-8750-E95B01F937B4"><span class="indent-level-default">1.</span><p class="p"> <a class="xref" href="https://ttssh2.osdn.jp/index.html.en" target="_blank">TeraTerm</a></p>
</li>
</ol>
</div>
<div class="section" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__SMARTPHONE-APP"><h2 class="title sectiontitle">Smartphone App</h2><p class="p">None</p>
</div>
<div class="section" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__PROGRAMMING-THE-PRECOMPILED-HEX-FILE-OR-APPLICATION-EXAMPLE"><h2 class="title sectiontitle">Programming the precompiled hex file or Application Example</h2><p class="p"><strong class="ph b">Programming the hex file using MPLABX IPE</strong></p>
<ol class="ol" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__GUID-86DFBE12-A651-42BA-B28A-3BBE8A45957A"><li class="li" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__GUID-615EAAB4-CA37-48DC-B8D6-A517E037C6B2"><span class="indent-level-default">1.</span><p class="p">Precompiled Hex file is located in "<span class="ph">&lt;Harmony Content
        Path&gt;\wireless_apps_pic32cxbz2_wbz45</span>\apps\ble\building_blocks\peripheral\ext_adv\hex" folder</p>
</li>
<li class="li" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__GUID-32A5BDB1-E7AC-43F3-8DE0-1C2A0C6B2BA4"><span class="indent-level-default">2.</span><p class="p">Follow the steps mentioned <a class="xref" href="https://microchipdeveloper.com/ipe:programming-device" target="_blank">here</a></p>
</li>
</ol>
<p class="p"><strong class="ph b">Caution:</strong> Users should choose the correct Device and Tool information</p>
<p class="p"><strong class="ph b">Programming the Application using MPLABX IDE</strong></p>
<ol class="ol" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__GUID-38E32D75-4A7E-4FCA-AB19-EAC72582B498"><li class="li" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__GUID-33A1AC6E-81BD-4873-9C21-CC3BF516AAC9"><span class="indent-level-default">1.</span><p class="p">Follow steps mentioned in of <a class="xref" href="GUID-EA74172C-595E-4A34-B359-D42EE443F0EC.html" title="Here is how to open, build and program an existing application example">Running a Precompiled Example</a> document</p>
</li>
<li class="li" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__GUID-87FDAD2C-721F-4193-A9F9-C5DFD00D8841"><span class="indent-level-default">2.</span><p class="p">Open and program the Application Example "ext_adv.x" located in "<span class="ph">&lt;Harmony Content
        Path&gt;\wireless_apps_pic32cxbz2_wbz45</span>\apps\ble\building_blocks\peripheral\ext_adv\firmware" using MPLABX IDE</p>
</li>
</ol>
<p class="p"><dfn class="term">&lt;Harmony Content Path&gt;</dfn> <a class="xref" href="GUID-A55E9342-CE44-4A91-86BB-FEC6706FCD1C.html#GUID-A55E9342-CE44-4A91-86BB-FEC6706FCD1C__GUID-C6B23D06-5DF8-4D73-B997-AC22020FE9D3">how to find what is my Harmony Content Path</a></p>
<p class="p"></p>
</div>
<div class="section" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__DEMO-DESCRIPTION"><h2 class="title sectiontitle">Demo Description</h2><p class="p">This Application Example enables users to transmit Extended Advertisements @ Coded PHY data rate of 125 Kbps. PDU types of ADV_EXT_IND and ADV_AUX_IND will be transmitted. Application data ("Microchip") is transmitted in Auxiliary packets (ADV_AUX_IND). ADV_EXT_IND carries the Auxiliary Packet Information (ADV_AUX_IND) for scanner to collect the data.</p>
<p class="p">Demo will print "Ext Adv Enabled" information indicating the successful start of Coded PHY Advertisements on a terminal emulator like TeraTerm @ (Speed: 115200, Data: 8-bit, Parity: none, stop bits: 1 bit, Flow control: none). Coded PHY Advertisements are configured to be sent every 2 secs.</p>
<p class="p">BLE Extended Advertisements (125 kbps, 500 kbps)cannot be scanned using a smartphone app. This could be due to support of only legacy advertisements on the smartphone or disabled extended adv API's in smartphone app.</p>
</div>
<div class="section" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__TESTING"><h2 class="title sectiontitle">Testing</h2><p class="p">Users can use another <span class="ph">WBZ451</span> Curiosity Board configured as <a class="xref" href="GUID-8C3372E5-CAB6-4923-9B59-E97022E1252D.html">BLE Scan Ext Adv</a></p>
<p class="p">This section assumes that a user has already programmed the ext_adv and scan_ext_adv application on 2 <span class="ph">WBZ451</span> Curiosity Boards.</p>
<p class="p">Board1 = <span class="ph">WBZ451</span> Curiosity Board with Ext Adv Programmed</p>
<p class="p">Board2 = <span class="ph">WBZ451</span> Curiosity Board with Scan Ext Adv Programmed</p>
<p class="p">Board1: Open TeraTerm @ (Speed: 115200, Data: 8-bit, Parity: none, stop bits: 1 bit, Flow control: none). Reset the board. Upon reset, "Ext Adv Enable" message is displayed on the TeraTerm.</p>
<p class="p">Board2: Open TeraTerm @ (Speed: 115200, Data: 8-bit, Parity: none, stop bits: 1 bit, Flow control: none). Reset the board. Upon reset, "ExtAdv Scan Enable Success" message is displayed on the TeraTerm. "Microchip" message will be displayed as soon the <span class="ph">WBZ451</span> module performs an extended advertisement scan.</p>
</div>
<div class="section" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__CURRENT-CONSUMPTION-MEASUREMENT"><h2 class="title sectiontitle">Current Consumption Measurement</h2><ul class="ul"><li class="li" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__GUID-2FF140DA-8464-460F-B4BE-93167D86AA36"><p class="p">Connect the Multimeter/Power Debugger/Oscillo Scope to Power Measurement Header J6. If using Power Debugger, users can use <a class="xref" href="https://www.microchip.com/en-us/development-tools-tools-and-software/embedded-software-center/atmel-data-visualizer" target="_blank">Data Visualizer</a> to measure the current consumption</p>
</li>
</ul>
<div class="p">Current measured in sleep/standby mode is 575.6 uA and avg current consumption is around 723.0 uA <div class="fig fignone" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__GUID-B97D046C-4CCA-4AFD-B984-10AAB99AE2AF"><div class="figcap"><span class="fig--title-label">Figure 1. </span>. </div><span class="desc figdesc"></span><img class="image" src="GUID-E1F1A1EC-5B6C-404C-B472-C07CC9635A76-low.jpg" /></div>
</div>
<p class="p">Users of this package should go through the known issues document and understand the limitations if any with the current low power mode implementation</p>
</div>
<div class="section" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__DEVELOPING-THIS-APPLICATION-FROM-SCRATCH-USING-MPLAB-CODE-CONFIGURATOR"><h2 class="title sectiontitle">Developing this Application from scratch using MPLAB Code Configurator</h2><p class="p">This section explains the steps required by a user to develop this application example from scratch using MPLABx Code Configurator</p>
<p class="p"><strong class="ph b">Tip:</strong> New users of MPLAB Code Configurator are recommended to go through the <a class="xref" href="https://onlinedocs.microchip.com/pr/GUID-1F7007B8-9A46-4D03-AEED-650357BA760D-en-US-6/index.html?GUID-B5D058F5-1D0B-4720-8649-ACE5C0EEE2C0" target="_blank">overview</a>.</p>
<ol class="ol" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__GUID-8FFB176A-7D65-454E-8971-56D1901A9904"><li class="li" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__GUID-BC50C178-47F7-4BCD-8B02-A52E4DC7A8B8"><span class="indent-level-default">1.</span><p class="p">Setup Harmony framework. EA release package has all the neccessary component and should be downloaded individually from the link provided in the package. It is recommended to create framework in the root directory. The framework looks like</p>
<br /><img class="image" src="GUID-6412BFC6-3711-4FCC-9C79-DD444EFE11AC-low.jpg" /><br /></li>
<li class="li" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__GUID-42432F1F-4DA4-446F-96EA-04511E311AC5"><span class="indent-level-default">2.</span><p class="p">Create a new MCC Harmony project - <a class="xref" href="GUID-B86E8493-D00D-46EF-8624-D412342147F0.html">instructions</a></p>
</li>
<li class="li" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__GUID-03E39604-0212-47FB-8457-DE2F6F30A8F0"><span class="indent-level-default">3.</span><div class="p">Drag and drop BLE_Stack in the project graph and select <strong class="ph b">Yes</strong> to all pop ups. Drag and Drop SERCOM0 from Peripherals into project graph for UART messages. Project Graph will look like<div class="fig fignone" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__GUID-7E93C7FA-C7B4-47BF-AC24-A3D0166EC987"><div class="figcap"><span class="fig--title-label">Figure 2. </span>. </div><span class="desc figdesc"></span><img class="image" src="GUID-8DCF2638-51E7-48EB-8EE1-BBBBBDDFB3F2-low.jpg" /></div>
</div>
</li>
<li class="li" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__GUID-170ABEA2-99CD-45A4-A07A-BF666E4160DA"><span class="indent-level-default">4.</span><p class="p">Enable Low Power</p>
<ul class="ul"><li class="li" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__GUID-9A8F9D11-9B8B-4A06-BF11-C1FE4C4EFAD2"><p class="p">Enable Low power mode by selecting <strong class="ph b">Low Power Enable</strong> in BLE_Stack Configuration. Select <strong class="ph b">Yes</strong> to all pop ups</p>
</li>
</ul>
<br /><img class="image" src="GUID-01B45BF1-82AB-465B-A9C2-D54B7A44E8F5-low.jpg" /><br /><ul class="ul"><li class="li" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__GUID-7505A877-D253-4B27-A348-E2B77714FB13"><p class="p">Click on Window-&gt;MCC-&gt;Harmony-&gt;Clock Configuration</p>
</li>
</ul>
<br /><img class="image" src="GUID-F57FF631-7704-4E3E-87C7-6CC12F71422B-low.png" /><br /><ul class="ul"><li class="li" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__GUID-F4FB0C23-4364-4B38-ACB3-21C8AB846EEE"><p class="p">Enable SOSC clock</p>
</li>
</ul>
<br /><img class="image" src="GUID-E3B6AD34-C5E8-4EEC-A69B-5E31756920B6-low.jpg" /><br /></li>
</ol>
</div>
<div class="section" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__CONFIGURE-ADVERTISEMENT-CONFIGURATION"><h2 class="title sectiontitle">Configure Advertisement Configuration</h2><ul class="ul"><li class="li" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__GUID-2A5F63AE-497A-45C4-8349-67B3810A7946"><p class="p">Select <strong class="ph b">BLE_Stack</strong> component in project graph and make modifications as shown below</p>
</li>
</ul>
<br /><img class="image" src="GUID-10B3AF0E-7113-4477-ACE5-CB6F8F64DC17-low.png" /><br /><br /><img class="image" src="GUID-C4A67A0F-7825-4683-A5CC-F5E6949C3BFB-low.png" /><br /></div>
<div class="section" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__CONFIGURE-UART"><h2 class="title sectiontitle">Configure UART</h2><p class="p">Uart Configuration Details can be found <a class="xref" href="GUID-E1A0E9CA-311E-4F53-9C27-160173609975.html">here</a></p>
</div>
<div class="section" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__GENERATE-CODE-LINK-FOR-INSTRUCTIONS"><h2 class="title sectiontitle">Generate Code</h2>Instructions on<a class="xref" href="GUID-9C28F407-4879-4174-9963-2CF34161398E.html">how to Generate Code</a></div>
<div class="section" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__FILES-AND-ROUTINES-AUTOMATICALLY-GENERATED-BY-THE-MCC"><h2 class="title sectiontitle">Files and Routines Automatically generated by the MCC</h2><p class="p">After generating the program source from MCC interface by clicking Generate Code, the BLE configuration can be found in the following project directories</p>
<br /><img class="image" src="GUID-C83DE0BA-9149-48FD-BC9C-913F98F584D0-low.png" /><br /><p class="p">The <a class="xref" href="http://ww1.microchip.com/downloads/en/DeviceDoc/MPLAB%20Harmony%20OSAL%20Libraries%20Help%20v2.06.pdf" target="_blank">OSAL</a> , RF System, BLE System initialization routine executed during program initialization can be found in the project files. This initialization routine is automatically generated by the MCC</p>
<br /><img class="image" src="GUID-BB85E5C0-A778-4BC8-AFA6-4435D5C15517-low.png" /><br /><p class="p">The BLE stack initialization routine excuted during Application Initialization can be found in project files. This intitialization routine is automatically generated by the MCC. This call initializes and configures the GAP, GATT, SMP, L2CAP and BLE middleware layers.</p>
<br /><img class="image" src="GUID-2A8C033E-C9EA-44F2-BF4E-AA78273B3862-low.png" /><br /><p class="p">Autogenerated, extended adverisement Data Format</p>
<br /><img class="image" src="GUID-B3C020F2-D2AB-4395-8CD1-F71DE645C6F3-low.png" /><br />
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__GUID-E7A5DD05-FD2D-4D6C-873A-5C8519E50456" class="table" frame="border" border="1" rules="all"><col style="width:" /><col style="width:" /><thead class="thead" style="text-align:left;"><tr class="row"><th class="entry cellrowborder" style="vertical-align:middle;" id="d30708e378"><span> <strong class="ph b">Source Files</strong></span></th>
<th class="entry cellrowborder" style="vertical-align:middle;" id="d30708e382"><span> <strong class="ph b">Usage</strong></span></th>
</tr>
</thead>
<tbody class="tbody"><tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d30708e378 "><span>app.c</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d30708e382 "><span>Application State machine, includes calls for Initialization of all BLE stack (GAP,GATT, SMP, L2CAP) related component configurations</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d30708e378 "><span><p class="p">app_ble\</p>
app_ble.c</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d30708e382 "><span>Source Code for the BLE stack related component configurations, code related to function calls from app.c</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d30708e378 "><span>app_ble\app_ble_handler.c</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d30708e382 "><span>All GAP, GATT, SMP and L2CAP Event handlers</span></td>
</tr>
<tr class="row"><td class="entry cellrowborder" style="vertical-align:middle;" headers="d30708e378 "><span>app_user_edits.c</span></td>
<td class="entry cellrowborder" style="vertical-align:middle;" headers="d30708e382 "><span>User Code Change instruction</span></td>
</tr>
</tbody>
</table>
</div>
<blockquote class="lq"><p class="p"><strong class="ph b">Tip:</strong> app.c is autogenerated and has a state machine based Application code sample, users can use this template to develop the application|</p>
</blockquote>
<p class="p"><strong class="ph b">Header Files</strong></p>
<ul class="ul"><li class="li" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__GUID-C058B23F-AEE9-4D6E-B41F-F81EE3C74219"><p class="p">ble_gap.h- This header file contains BLE GAP functions and is automatically included in the app.c file</p>
</li>
</ul>
<p class="p"><strong class="ph b">Function Calls</strong></p>
<p class="p">MCC generates and adds the code to initialize the BLE Stack GAP, GATT, L2CAP and SMP in <em class="ph i">APP_BleStackInit()</em> function</p>
<ul class="ul"><li class="li" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__GUID-FE32E834-D643-43A9-BB22-94784D434A9B"><p class="p">APP_BleStackInit() is the API that will be called inside the Applications Initial State -- APP_STATE_INIT in app.c</p>
</li>
<li class="li" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__GUID-03A69119-8908-43E7-8B35-3B2A9A048489"><p class="p">RTC_Timer32Start() defined in plib_rtc_timer.c. It call to start RTC Timer clock to facilitate low power mode.</p>
</li>
</ul>
</div>
<div class="section" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__USER-APPLICATION-DEVELOPMENT"><h2 class="title sectiontitle">User Application Development</h2><p class="p"><strong class="ph b">Include</strong></p>
<ul class="ul"><li class="li" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__GUID-06B365E2-49E9-441E-A92D-1EEB25AF14AE"><p class="p">definitions.h in all the files where UART will be used to print debug information</p>
</li>
</ul>
<blockquote class="lq"><p class="p">Tip: definitions.h is not specific to just UART peripheral, instead it should be included in all application source files where peripheral functionality will be exercised</p>
</blockquote>
<ul class="ul"><li class="li" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__GUID-08A8FCDB-B807-42E3-8943-A591CB6442B3"><p class="p">user action is required as mentioned <a class="xref" href="GUID-99583057-8B1A-42F2-84E8-CFC7717FA5D1.html">here</a></p>
</li>
</ul>
<p class="p"><strong class="ph b">Start Ext Advertisement</strong></p>
<ul class="ul"><li class="li" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__GUID-B4A25CC4-0C7D-48C4-991E-55AEE6A30CF7"><p class="p">BLE_GAP_SetExtAdvEnable(true, 0x01, &amp;extAdvEnableParam);</p>
</li>
</ul>
<p class="p">This API is called in the Applications initialstate - APP_STATE_INIT in app.c. Parameters for extended advertisement should be chosen. Below is an example.</p>
<br /><img class="image" src="GUID-0178BB7A-6F53-42C9-90E9-DECEFC15011E-low.png" /><br /><p class="p">Users can exercise various other BLE Advertisement functionalities by using <a class="xref" href="https://onlinedocs.microchip.com/pr/GUID-C5EAF60E-9124-427C-A0F1-F2DBE662EA92-en-US-1/index.html" target="_blank">BLE Stack API</a></p>
</div>
<div class="section" id="GUID-9A3C4C97-E09F-4FF9-878C-3873892445F4__WHERE-TO-GO-FROM-HERE"><h2 class="title sectiontitle">Where to go from here</h2><p class="p"> <a class="xref" href="GUID-B3B46369-F5B4-401B-8405-658BE34988F4.html">Getting Started with Peripheral Building Blocks</a></p>
</div>
</div>
<div class="related-links">
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="GUID-B3B46369-F5B4-401B-8405-658BE34988F4.html">Peripheral</a></div>
</div>
</div></body>
</html>